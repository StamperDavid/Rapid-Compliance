# Atomic Quality Control: Only check staged files for ESLint
# TypeScript check runs on full project (required for type resolution)
# Note: husky runs this with `sh -e`, so every command must exit 0 or the hook aborts.

export NODE_OPTIONS="--max-old-space-size=8192"

echo "Running Atomic Quality Control..."

# Step 1: Lint only staged .ts/.tsx files (zero-tolerance)
echo "ESLint: Checking staged files..."
node scripts/run-lint-staged.js || exit 1

# Step 2: TypeScript check (full project, but fast since it's incremental)
# Uses Node.js directly to avoid npx exit-code bug on Windows
echo "TypeScript: Checking for build blockers..."
node scripts/run-tsc-check.js || exit 1

# Step 3: Bypass budget ratchet (eslint-disable count can only go DOWN)
echo "Bypass Ratchet: Checking eslint-disable budget..."
node scripts/check-bypass-budget.js || exit 1

echo "Quality check passed!"
